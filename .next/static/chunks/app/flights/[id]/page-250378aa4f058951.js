(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[828],{2449:(e,s,a)=>{Promise.resolve().then(a.bind(a,6694))},5695:(e,s,a)=>{"use strict";var t=a(8999);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})},6694:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var t=a(5155),r=a(2115),l=a(5695),i=a(6874),n=a.n(i);function d(){let e=(0,l.useParams)(),s=(0,l.useRouter)(),[a,i]=(0,r.useState)(null),[d,c]=(0,r.useState)([]),[o,m]=(0,r.useState)([]),[x,h]=(0,r.useState)(!0),[u,g]=(0,r.useState)(null),[b,f]=(0,r.useState)({checkIn:0,boardingExp:0,cabinCrew:0,seatComfort:0,foodQuality:0,entertainment:0,flightPerf:0,valueForMoney:0,overallRating:0}),[j,v]=(0,r.useState)(""),[p,y]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),[k,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/session"),s=await e.json();w(s)}catch(e){console.error("Failed to fetch session:",e)}})()},[]),(0,r.useEffect)(()=>{e.id&&(F(),S(),E())},[e.id]),(0,r.useEffect)(()=>{var e;if((null==N?void 0:null===(e=N.user)||void 0===e?void 0:e.id)&&d.length>0){let e=d.find(e=>{var s;return e.userId===(null===(s=N.user)||void 0===s?void 0:s.id)});e&&(C(!0),f({checkIn:e.checkIn,boardingExp:e.boardingExp,cabinCrew:e.cabinCrew,seatComfort:e.seatComfort,foodQuality:e.foodQuality,entertainment:e.entertainment,flightPerf:e.flightPerf,valueForMoney:e.valueForMoney,overallRating:e.overallRating}))}},[N,d]);let F=async()=>{try{h(!0);let s=await fetch("/api/flights?id=".concat(e.id));if(!s.ok)throw Error("Failed to fetch flight details");let a=await s.json();a.length>0?i(a[0]):g("Flight not found")}catch(e){g(e instanceof Error?e.message:"An error occurred")}finally{h(!1)}},S=async()=>{try{let s=await fetch("/api/ratings?flightId=".concat(e.id));if(!s.ok)throw Error("Failed to fetch ratings");let a=await s.json();c(a)}catch(e){console.error("Error fetching ratings:",e)}},E=async()=>{try{let s=await fetch("/api/reviews?flightId=".concat(e.id));if(!s.ok)throw Error("Failed to fetch reviews");let a=await s.json();m(a)}catch(e){console.error("Error fetching reviews:",e)}},P=(e,s)=>{f(a=>({...a,[e]:s}))},R=async a=>{if(a.preventDefault(),!N){s.push("/login");return}try{if(y(!0),!(await fetch("/api/ratings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({flightId:e.id,...b})})).ok)throw Error("Failed to submit rating");S(),C(!0)}catch(e){console.error("Error submitting rating:",e),alert("Failed to submit rating. Please try again.")}finally{y(!1)}},O=async a=>{if(a.preventDefault(),!N){s.push("/login");return}if(!j.trim()){alert("Please enter a review");return}try{if(y(!0),!(await fetch("/api/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({flightId:e.id,content:j})})).ok)throw Error("Failed to submit review");E(),v("")}catch(e){console.error("Error submitting review:",e),alert("Failed to submit review. Please try again.")}finally{y(!1)}},I=e=>new Date(e).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),M=e=>0===d.length?0:(d.reduce((s,a)=>s+a[e],0)/d.length).toFixed(1),Q=e=>{let{value:s,onChange:a,readOnly:r=!1}=e;return(0,t.jsx)("div",{className:"flex",children:[1,2,3,4,5].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>!r&&a&&a(e),className:"".concat(r?"cursor-default":"cursor-pointer"," ").concat(e<=s?"text-yellow-400":"text-gray-300"," text-2xl focus:outline-none"),disabled:r,children:"★"},e))})};return x?(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 text-center",children:[(0,t.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"}),(0,t.jsx)("p",{className:"mt-2",children:"Loading flight details..."})]}):u||!a?(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:u||"Flight not found"}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(n(),{href:"/flights",className:"text-blue-600 hover:underline",children:"← Back to flights"})})]}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(n(),{href:"/flights",className:"text-blue-600 hover:underline",children:"← Back to flights"})}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:[a.airline.name," ",a.flightNumber]}),(0,t.jsxs)("p",{className:"text-gray-600 dark:text-gray-400",children:[a.origin," to ",a.destination]})]}),(0,t.jsx)("div",{className:"mt-4 md:mt-0",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-500 mr-2",children:M("overallRating")}),(0,t.jsx)(Q,{value:parseFloat(M("overallRating")),readOnly:!0}),(0,t.jsxs)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:["(",d.length," ratings)"]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Flight Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Departure"}),(0,t.jsx)("p",{className:"font-semibold",children:I(a.departureTime)}),(0,t.jsx)("p",{className:"text-lg font-bold",children:a.origin})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Arrival"}),(0,t.jsx)("p",{className:"font-semibold",children:I(a.arrivalTime)}),(0,t.jsx)("p",{className:"text-lg font-bold",children:a.destination})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Airline Information"}),(0,t.jsx)("p",{children:a.airline.description||"No description available."})]})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Ratings Summary"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Check-in Experience"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("checkIn")}),(0,t.jsx)(Q,{value:parseFloat(M("checkIn")),readOnly:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Boarding Experience"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("boardingExp")}),(0,t.jsx)(Q,{value:parseFloat(M("boardingExp")),readOnly:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Cabin Crew"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("cabinCrew")}),(0,t.jsx)(Q,{value:parseFloat(M("cabinCrew")),readOnly:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Seat Comfort"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("seatComfort")}),(0,t.jsx)(Q,{value:parseFloat(M("seatComfort")),readOnly:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Food Quality"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("foodQuality")}),(0,t.jsx)(Q,{value:parseFloat(M("foodQuality")),readOnly:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Entertainment"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("entertainment")}),(0,t.jsx)(Q,{value:parseFloat(M("entertainment")),readOnly:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Flight Performance"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("flightPerf")}),(0,t.jsx)(Q,{value:parseFloat(M("flightPerf")),readOnly:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-1",children:"Value for Money"}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"font-bold mr-2",children:M("valueForMoney")}),(0,t.jsx)(Q,{value:parseFloat(M("valueForMoney")),readOnly:!0})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Rate This Flight"}),N?(0,t.jsxs)("form",{onSubmit:R,children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Check-in Experience"}),(0,t.jsx)(Q,{value:b.checkIn,onChange:e=>P("checkIn",e)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Boarding Experience"}),(0,t.jsx)(Q,{value:b.boardingExp,onChange:e=>P("boardingExp",e)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Cabin Crew"}),(0,t.jsx)(Q,{value:b.cabinCrew,onChange:e=>P("cabinCrew",e)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Seat Comfort"}),(0,t.jsx)(Q,{value:b.seatComfort,onChange:e=>P("seatComfort",e)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Food Quality"}),(0,t.jsx)(Q,{value:b.foodQuality,onChange:e=>P("foodQuality",e)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Entertainment"}),(0,t.jsx)(Q,{value:b.entertainment,onChange:e=>P("entertainment",e)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Flight Performance"}),(0,t.jsx)(Q,{value:b.flightPerf,onChange:e=>P("flightPerf",e)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Value for Money"}),(0,t.jsx)(Q,{value:b.valueForMoney,onChange:e=>P("valueForMoney",e)})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Overall Rating"}),(0,t.jsx)(Q,{value:b.overallRating,onChange:e=>P("overallRating",e)})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",disabled:p,children:p?"Submitting...":k?"Update Rating":"Submit Rating"})})]}):(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)("p",{className:"mb-4",children:"Please sign in to rate this flight"}),(0,t.jsx)(n(),{href:"/login?callbackUrl=/flights/".concat(e.id),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Sign In"})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[(0,t.jsxs)("h2",{className:"text-2xl font-semibold mb-6",children:["Reviews (",o.length,")"]}),N&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Write a Review"}),(0,t.jsxs)("form",{onSubmit:O,children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("textarea",{value:j,onChange:e=>{v(e.target.value)},className:"w-full p-3 border rounded-md",rows:4,placeholder:"Share your experience with this flight...",required:!0})}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",disabled:p,children:p?"Submitting...":"Submit Review"})})]})]}),0===o.length?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No reviews yet. Be the first to review this flight!"})}):(0,t.jsx)("div",{className:"space-y-6",children:o.map(e=>(0,t.jsxs)("div",{className:"border-b pb-6 last:border-b-0 last:pb-0",children:[(0,t.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"font-semibold",children:e.user.name||"Anonymous"}),(0,t.jsx)("div",{className:"text-gray-600 dark:text-gray-400 text-sm ml-2",children:new Date(e.createdAt).toLocaleDateString()})]})}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:e.content})]},e.id))})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[874,441,684,358],()=>s(2449)),_N_E=e.O()}]);