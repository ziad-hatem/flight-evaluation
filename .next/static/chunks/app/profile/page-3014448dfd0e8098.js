(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{1723:(e,s,r)=>{Promise.resolve().then(r.bind(r,3246))},3246:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>i});var a=r(5155),l=r(2115),t=r(5695),n=r(2108),d=r(6874),o=r.n(d);function i(){let e=(0,t.useRouter)(),[s,r]=(0,l.useState)(null),[d,i]=(0,l.useState)(!0),[c,m]=(0,l.useState)(null),[u,h]=(0,l.useState)({name:"",email:"",currentPassword:"",newPassword:"",confirmPassword:""}),[x,p]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[f,g]=(0,l.useState)(null),{data:j,status:N}=(0,n.useSession)();(0,l.useEffect)(()=>{var s;"loading"!==N&&(console.log("Session status:",N,"Session data:",j),"authenticated"===N&&(null==j?void 0:null===(s=j.user)||void 0===s?void 0:s.id)?(console.log("User authenticated, fetching profile with ID:",j.user.id),v()):"unauthenticated"===N&&(console.log("User not authenticated, redirecting to login"),e.push("/login?callbackUrl=/profile")))},[j,N,e]);let v=async()=>{try{i(!0);let s=await fetch("/api/auth/profile",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!s.ok){if(401===s.status){e.push("/login?callbackUrl=/profile");return}throw Error("Failed to fetch profile")}let a=await s.json();r(a),h({name:a.name||"",email:a.email||"",currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){m(e instanceof Error?e.message:"An error occurred"),console.error("Profile fetch error:",e)}finally{i(!1)}},P=e=>{let{name:s,value:r}=e.target;h(e=>({...e,[s]:r}))},y=async e=>{if(e.preventDefault(),g(null),w(!1),u.newPassword){if(u.newPassword.length<8){g("New password must be at least 8 characters long");return}if(u.newPassword!==u.confirmPassword){g("New passwords do not match");return}if(!u.currentPassword){g("Current password is required to set a new password");return}}try{let e=await fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:u.name,email:u.email,currentPassword:u.currentPassword||void 0,newPassword:u.newPassword||void 0})}),s=await e.json();if(!e.ok)throw Error(s.message||"Update failed");w(!0),r(e=>e?{...e,name:u.name,email:u.email}:null),h(e=>({...e,currentPassword:"",newPassword:"",confirmPassword:""})),p(!1)}catch(e){g(e instanceof Error?e.message:"Update failed"),console.error("Profile update error:",e)}};return d?(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8 text-center",children:[(0,a.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"}),(0,a.jsx)("p",{className:"mt-2",children:"Loading profile..."})]}):c?(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:(0,a.jsx)("span",{className:"block sm:inline",children:c})})}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Your Profile"}),b&&(0,a.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6",role:"alert",children:(0,a.jsx)("span",{className:"block sm:inline",children:"Profile updated successfully!"})}),f&&(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6",role:"alert",children:(0,a.jsx)("span",{className:"block sm:inline",children:f})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:x?(0,a.jsxs)("form",{onSubmit:y,children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Edit Profile"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium mb-1",children:"Name"}),(0,a.jsx)("input",{id:"name",name:"name",type:"text",value:u.name,onChange:P,className:"w-full p-2 border rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium mb-1",children:"Email"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",value:u.email,onChange:P,className:"w-full p-2 border rounded-md",required:!0})]}),(0,a.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Change Password (Optional)"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium mb-1",children:"Current Password"}),(0,a.jsx)("input",{id:"currentPassword",name:"currentPassword",type:"password",value:u.currentPassword,onChange:P,className:"w-full p-2 border rounded-md"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium mb-1",children:"New Password"}),(0,a.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",value:u.newPassword,onChange:P,className:"w-full p-2 border rounded-md"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium mb-1",children:"Confirm New Password"}),(0,a.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",value:u.confirmPassword,onChange:P,className:"w-full p-2 border rounded-md"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-6",children:[(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Save Changes"}),(0,a.jsx)("button",{type:"button",onClick:()=>{p(!1),h({name:(null==s?void 0:s.name)||"",email:(null==s?void 0:s.email)||"",currentPassword:"",newPassword:"",confirmPassword:""}),g(null)},className:"bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"})]})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Account Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Name"}),(0,a.jsx)("p",{className:"font-medium",children:null==s?void 0:s.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Email"}),(0,a.jsx)("p",{className:"font-medium",children:null==s?void 0:s.email})]})]})]}),(0,a.jsx)("button",{onClick:()=>p(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Edit Profile"})]})}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Your Activity"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-center",children:[(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:"0"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Flight Ratings"})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:"0"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Reviews Written"})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:"0"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Helpful Votes"})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(o(),{href:"/flights",className:"text-blue-600 hover:underline",children:"Browse flights to rate â†’"})})]})]})}},5695:(e,s,r)=>{"use strict";var a=r(8999);r.o(a,"useParams")&&r.d(s,{useParams:function(){return a.useParams}}),r.o(a,"useRouter")&&r.d(s,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(s,{useSearchParams:function(){return a.useSearchParams}})}},e=>{var s=s=>e(e.s=s);e.O(0,[874,108,441,684,358],()=>s(1723)),_N_E=e.O()}]);